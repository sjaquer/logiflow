rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // WARNING: The rules below are permissive and intended for development or
    // staging environments where you want any authenticated user to be able to
    // perform application flows (assign leads, create orders, save clients, etc.).
    // Do NOT use these exact rules in production without reviewing and hardening
    // them according to your security model.

    // Allow any authenticated user to read and write users collection.
    // This lets onboarding and fallback user creation (addDoc) succeed from the client.
    match /users/{userId} {
      allow read, write: if request.auth != null;
    }

    // Allow authenticated access for clients (leads/customers)
    match /clients/{clientId} {
      allow read, write: if request.auth != null;
    }

    // Allow authenticated access for shopify leads
    match /shopify_leads/{leadId} {
      allow read, write: if request.auth != null;
    }

    // Allow authenticated access for orders - required so users can create/update orders
    match /orders/{orderId} {
      allow read, write: if request.auth != null;
    }

    // Inventory access - allow authenticated users to read and write in dev
    match /inventory/{itemId} {
      allow read, write: if request.auth != null;
    }

    // Fallback: authenticated users can read other documents, but writes are denied by default.
    match /{document=**} {
      allow read: if request.auth != null;
      allow write: if false;
    }
  }
}
